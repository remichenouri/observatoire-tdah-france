import pandas as pd
import numpy as np

np.random.seed(42)

# 1. Paramètres globaux
n = 1_000_000
dates = pd.date_range("2018-01-01", "2024-12-31", freq="D")
medicaments = ["Méthylphénidate", "Lisdexamphétamine", "Atomoxétine"]
parts = [0.75, 0.20, 0.05]  # répartitions approximatives

# 2. Tirages aléatoires
df = pd.DataFrame({
    "date_prescription": np.random.choice(dates, size=n, p=None),
    "département": np.random.choice([f"{i:02d}" for i in range(1, 96)], size=n),
    "médicament": np.random.choice(medicaments, size=n, p=parts),
    "âge_patient": np.random.choice(
        np.concatenate([
            np.random.randint(6, 12, size=int(n*0.4)),
            np.random.randint(12, 18, size=int(n*0.3)),
            np.random.randint(18, 60, size=int(n*0.3))
        ]),
        size=n
    ),
    "sexe_patient": np.random.choice(["F","M"], size=n, p=[0.45,0.55]),
    "nombre_doses": np.random.poisson(lam=30, size=n)
})

# 3. Tri et nettoyage
df = df.sort_values("date_prescription").reset_index(drop=True)
df["date_prescription"] = pd.to_datetime(df["date_prescription"])
df = df[df["âge_patient"] >= 6]  # respecter indications

# 4. Export CSV
df.to_csv("data/prescriptions_2018_2024.csv", index=False)
